<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="./bootstrap_min.css" media="screen">
    <script src="./jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="./bootstrap.min.js" type="text/javascript"></script>
    <title>yet another better [adult swim] schedule</title>
</head>

<body>
    <div class="container">
        <div class="page-header" id="banner">
            <h1>yet another better [adult swim] schedule</h1>
            <p class="lead"><a href="#" id="toggle" style="color: inherit;">wanna seeee into the future?</a></p>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-4 col-sm-5">
                <ul class="nav nav-pills nav-stacked">
                    <li><a data-toggle="pill" href="#loading">Loading schedule data...</a></li>
                    <li><a data-toggle="pill" href="#loading">If nothing happens, either your Internet or JavaScript settings is f**ked up.</a></li>
                </ul>
            </div>
            <div class="col-lg-9 col-md-8 col-sm-7">
                <div id="schedule" class="tab-content">
                </div>
            </div>
        </div>
        <footer class="page-footer">
            <div class="row">
                <div class="col-lg-12">
                    <p>
                        <a href="//swimpedia.net/oldsched/" rel="nofollow">originally</a> created by <a href="//twitter.com/jessfromabove" rel="nofollow">someone</a>
                        using a little bit of <a href="//getbootstrap.com" rel="nofollow">this</a> and a little bit of <a href="//jquery.com/" rel="nofollow">that</a>
                        on a bored halloween evening. colours by <a href="//bootswatch.com/" rel="nofollow">tom</a>.
                    </p>
                    <p>
                        adapted by <a href="//github.com/SerCom-KC" rel="nofollow">someone else</a>
                        <s>using a little bit of <a href="//www.python.org" rel="nofollow">this</a> and a little bit of <a href="//github.com/features/actions" rel="nofollow">that</a></s>
                        on a bored-but-not-halloween evening. source code available at <a href="//github.com/SerCom-KC/adult-swim-schedule" rel="nofollow">somewhere</a>.
                    </p>
                    <p>something weird happened? report it <a href="//github.com/SerCom-KC/adult-swim-schedule/issues/new" rel="nofollow">here</a>.
                    </p>
                    <p>
                        in no way affilliated with adult swim, cartoon network or it's parent companies or subsidiaries.
                        schedule data is pulled from <a href="#" id="source" rel="nofollow">official json and/or xml sources</a> and is correct at time of
                        publication.
                    </p>
                    <p>shout outs <a href="//twitter.com/swimpedia" rel="nofollow">@swimpedia</a>, /r/adultswim, /r/toonami, /co/, toonamiarsenal, bumpworthy and myspleen.</p>
                </div>
            </div>
        </footer>
    </div>
    <script>
        const toonami_disclaimer = '<div class="alert alert-danger"><h4>Important:</h4><p>Please <b>do not</b> contact any Adult Swim employee on social media regarding any schedule information this page provides. <br>Treat any future Toonami schedule information as a placeholder until an official announcement is made.</p></div>';
        window.onload = async() => {
            var toonami = (new URLSearchParams(location.search)).get("toonami") != null;
            if (toonami) {
                document.title = "yet another better TOONAMI schedule"
            }
            $("h1")[0].innerText = document.title;
            $("#toggle")[0].href = toonami ? location.pathname : location.pathname + "?toonami";

            var source_url = `https://api.adultswim.com/v1?${new URLSearchParams({
                "variables": JSON.stringify(toonami ? {"weeks": 4} : {"days": 7}),
                "extensions": JSON.stringify({
                    "persistedQuery": {
                        "version": 1,
                        "sha256Hash": toonami ? "f6e9d009615d56a416a9eea6207204044b207260946d0b47c36f7a94bdac755c" : "e859b453581f2e566cf104549773b8a60c8f5e68ec033fdc4d96634b9b2291ac"
                    }
                })
            })}`;
            $("#source")[0].href = source_url;

            var resp = await fetch(source_url);
            resp = await resp.json();
            var linear_blocks = resp.data.linear.nodes;

            var navigation = $(".nav")[0];
            var schedule = $("#schedule")[0];
            navigation.innerHTML = "";
            schedule.innerHTML = "";

            for (var i = 0; i < linear_blocks.length; i++) {
                var block_date = new Date(linear_blocks[i].startTime);
                if (toonami) {
                    block_date = new Date(block_date.getTime() - 4 * 60 * 60 * 1000);
                }
                var block_day = parseInt(block_date.toLocaleString("en-US", {timeZone: "US/Eastern", day: "numeric"}));
                var block_day_suffix = "th";
                if (block_day < 10 || block_day > 20) {
                    switch (block_day % 10) {
                        case 1:
                            block_day_suffix = "st";
                            break;
                        case 2:
                            block_day_suffix = "nd";
                            break;
                        case 3:
                            block_day_suffix = "rd";
                            break;
                        default:
                            break;
                    }
                }
                navigation.innerHTML += `<li><a data-toggle="pill" href="#day${block_day}">${block_date.toLocaleString("en-US", {timeZone: "US/Eastern", weekday: "long", day: "numeric", month: "long"})}${block_day_suffix}</a></li>`;

                var linear_airings = linear_blocks[i].schedule.nodes;
                var block_html = "";

                for (var j = 0; j < linear_airings.length; j++) {
                    if (linear_airings[j].seriesScarlettID == 478292) {
                        console.info("DST changes detected, skipping");
                        continue;
                    }

                    var airing_date = new Date(linear_airings[j].startTime);

                    block_html += `<tr><td class="col-md-1 text-right vert-align"><b>${airing_date.toLocaleString("en-US", {timeZone: "US/Eastern", hour12: true, hour: "numeric", minute: "2-digit"}).toLowerCase().replace(" ", "")}</b></td><td>${linear_airings[j].seriesTitle}<br><small>"${linear_airings[j].title}"</small></td><td class="col-md-2 vert-align">${linear_airings[j].tvRating.replace(" ", "")}</td>`;
                }

                schedule.innerHTML += `<div class="tab-pane fade" id="day${block_day}">${toonami ? toonami_disclaimer : ""}<table class="table table-striped table-hover"><tbody>${block_html}</tbody></table></div>`;
            }
        };
    </script>
</body>

</html>